# G1 æœºå™¨äººéƒ¨ç½²å¿«é€ŸæŒ‡å—

## ğŸ“¦ åŠ¨ä½œæ•°æ®è½¬æ¢

### æ”¯æŒçš„æ•°æ®æ ¼å¼

Sim2Sim/Sim2Real æ”¯æŒä¸¤ç§ NPZ æ ¼å¼ï¼š

**1. éƒ¨ç½²æ ¼å¼ï¼ˆæ¨ç†ç”¨ï¼‰**
```python
{
    'fps': å¸§ç‡,
    'root_pos': (T, 3),      # æ ¹ä½ç½®
    'root_rot': (T, 4),      # æ ¹æ—‹è½¬ (xyzw)
    'dof_pos': (T, 29),      # å…³èŠ‚ä½ç½® (MTé¡ºåº)
    'joint_names': (29,)     # å¯é€‰
}
```

**2. è®­ç»ƒæ ¼å¼ï¼ˆè®­ç»ƒç”¨ï¼ŒåŒ…å«FKæ•°æ®ï¼‰**
```python
{
    # éƒ¨ç½²æ ¼å¼çš„æ‰€æœ‰å­—æ®µ +
    'local_body_pos': (T, 41, 3),   # å±€éƒ¨èº«ä½“ä½ç½®
    'local_body_rot': (T, 41, 4),   # å±€éƒ¨èº«ä½“æ—‹è½¬
    'body_names': (41,)
}
```

### è½¬æ¢ Isaac æ ¼å¼æ•°æ®

å¦‚æœä½ æœ‰ Isaac æ ¼å¼çš„ NPZ æ–‡ä»¶ï¼ˆ`joint_pos`, `root_pos`, `root_rot`ï¼‰ï¼Œä½¿ç”¨ï¼š

```bash
# è½¬æ¢ä¸ºéƒ¨ç½²æ ¼å¼ï¼ˆå¸¦å…³èŠ‚é‡æ’ï¼‰
python3 convert_simple_to_deploy.py \
    000003.npz \
    sim2real/assets/data/000003.npz \
    --from-isaac
```

**âš ï¸ é‡è¦ï¼š** `--from-isaac` æ ‡å¿—ä¼šå°†å…³èŠ‚ä» Isaac é¡ºåºï¼ˆå·¦å³äº¤æ›¿ï¼‰é‡æ’ä¸º MT é¡ºåºï¼ˆæŒ‰éƒ¨ä½åˆ†ç»„ï¼‰

### å…³èŠ‚é¡ºåºè¯´æ˜

- **Isaac é¡ºåº**ï¼š`left_hip_pitch`, `right_hip_pitch`, `waist_yaw`, ...ï¼ˆå·¦å³äº¤æ›¿ï¼‰
- **MT é¡ºåº**ï¼šå·¦è…¿å…¨éƒ¨ â†’ å³è…¿å…¨éƒ¨ â†’ è…°éƒ¨ â†’ å·¦è‡‚ â†’ å³è‡‚

### æ·»åŠ æ–°åŠ¨ä½œ

1. è½¬æ¢æ–‡ä»¶åˆ° `sim2real/assets/data/`
2. ç¼–è¾‘ `sim2real/config/tracking.yaml`ï¼š
```yaml
motions:
  - name: "my_motion"
    path: "assets/data/my_motion.npz"
    start: 0
    end: -1
```
3. åœ¨ motion_select ä¸­è¾“å…¥ `r` é‡æ–°åŠ è½½

---

## ğŸŒ ç½‘ç»œé…ç½®

```bash
# ç¡®ä¿ç½‘å¡å¯åŠ¨
sudo ip link set enp4s0 up

# é…ç½®é™æ€ IPï¼ˆä¸ G1 åœ¨åŒä¸€ç½‘æ®µï¼‰
sudo ip addr add 192.168.123.100/24 dev enp4s0

# éªŒè¯é…ç½®
ip addr show enp4s0

# æµ‹è¯•è¿é€šæ€§ï¼ˆG1 é»˜è®¤ IP: 192.168.123.161ï¼‰
ping -c 3 192.168.123.161
```

---

## ğŸ”‘ å…³é”®æ­¥éª¤ï¼šè¿›å…¥è°ƒè¯•æ¨¡å¼

**âš ï¸ å¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼**

### G1 æ¨¡å¼è¯´æ˜
- **ç´«ç¯å¸¸äº®** - é›¶åŠ›çŸ©æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œæ— æ³•åº•å±‚æ§åˆ¶ï¼‰
- **æ©™ç¯å¸¸äº®** - è°ƒè¯•æ¨¡å¼/é˜»å°¼æ¨¡å¼ï¼ˆå¯ä»¥åº•å±‚æ§åˆ¶ï¼‰

### è¿›å…¥è°ƒè¯•æ¨¡å¼
ä½¿ç”¨é¥æ§å™¨ï¼š
1. **åŒæ—¶æŒ‰ä½ `L2` + `R2`**
2. ç¯å…‰å˜ä¸º **æ©™ç¯å¸¸äº®**
3. æ­¤æ—¶å¯ä»¥è¿è¡Œåº•å±‚æ§åˆ¶

---

## ğŸš€ Sim2Sim ä»¿çœŸæµ‹è¯•

### ç»ˆç«¯ 1ï¼šå¯åŠ¨ä»¿çœŸå™¨
```bash
cd /home/limx/project/motion_tracking
conda activate gentle
python3 sim2real/src/sim2sim.py --xml_path g1/g1.xml
```

**æ³¨æ„ï¼š** `--xml_path` è·¯å¾„æ˜¯ç›¸å¯¹äº `sim2real/assets/` çš„

### ç»ˆç«¯ 2ï¼šå¯åŠ¨æ§åˆ¶å™¨
```bash
cd /home/limx/project/motion_tracking
conda activate gentle
python3 sim2real/src/deploy.py --net lo --sim2sim
```

### ç»ˆç«¯ 1ï¼šæŒ‰é”®æ“ä½œ
- æŒ‰ `s` â†’ ç§»åŠ¨åˆ°é»˜è®¤å§¿æ€
- æŒ‰ `a` â†’ å¼€å§‹è¿åŠ¨è¿½è¸ª
- æŒ‰ `x` â†’ é€€å‡º

### ç»ˆç«¯ 3ï¼šè¿åŠ¨åˆ‡æ¢ï¼ˆå¯é€‰ï¼‰
```bash
cd /home/limx/project/motion_tracking
python3 sim2real/src/motion_select.py

# å‘½ä»¤
2              # é€‰æ‹©ç¼–å·ä¸º 2 çš„åŠ¨ä½œ
motion_000003  # ç›´æ¥è¾“å…¥åŠ¨ä½œåç§°
r              # é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
list           # æ˜¾ç¤ºæ‰€æœ‰åŠ¨ä½œ
q              # é€€å‡º
```

**æç¤ºï¼š** ç­–ç•¥åŠ è½½æ”¯æŒ `dof_pos` æˆ– `joint_pos` å­—æ®µï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰

---

## ğŸ¤– çœŸæœºéƒ¨ç½²

### 1. å…³é—­å†²çªæœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
cd /home/limx/project/motion_tracking/sim2real
conda activate gentle
python3 disable_test_services.py enp4s0
```

### 2. å¯åŠ¨æ§åˆ¶å™¨
```bash
python3 src/deploy.py --net enp4s0 --real
```

### 3. é¥æ§å™¨æ“ä½œæµç¨‹

**æ­¥éª¤ 1ï¼šè¿›å…¥è°ƒè¯•æ¨¡å¼**
```
æ“ä½œï¼šåŒæ—¶æŒ‰ L2 + R2
ç»“æœï¼šæ©™ç¯å¸¸äº®
```

**æ­¥éª¤ 2ï¼šå¯åŠ¨æ§åˆ¶**
```
ç»ˆç«¯æ˜¾ç¤ºï¼šWaiting for the start signal...
æ“ä½œï¼šæŒ‰ start é”®
ç»“æœï¼šæœºå™¨äººç§»åŠ¨åˆ°é»˜è®¤å§¿æ€
ç»ˆç«¯æ˜¾ç¤ºï¼šMoving to init pos....
```

**æ­¥éª¤ 3ï¼šæ¿€æ´»ç­–ç•¥**
```
ç»ˆç«¯æ˜¾ç¤ºï¼šPress A to tracking policy...
æ“ä½œï¼šæŒ‰ A é”®
ç»“æœï¼šå¼€å§‹è¿åŠ¨è¿½è¸ª
ç»ˆç«¯æ˜¾ç¤ºï¼šRunning high level...
             Time: 0.00, Height: 0.78
```

**æ­¥éª¤ 4ï¼šåœæ­¢**
```
æ“ä½œï¼šæŒ‰ select é”®
ç»“æœï¼šå®‰å…¨é€€å‡º
```

### 4. è¿åŠ¨åˆ‡æ¢ï¼ˆå¯é€‰ï¼‰
```bash
# æ‰“å¼€æ–°ç»ˆç«¯
python3 src/motion_select.py

# å¯ç”¨è¿åŠ¨
1    # default - ç«™ç«‹
12   # walk1_subject1 - è¡Œèµ°
9    # run1_subject2 - è·‘æ­¥
2    # dance1_subject1 - è·³èˆ
```

---

## ğŸ”§ å¸¸ç”¨å·¥å…·

### æµ‹è¯•è¿æ¥
```bash
python3 test_connection.py enp4s0
```

### è°ƒè¯•çŠ¶æ€
```bash
python3 debug_robot_state.py enp4s0
```

### æ£€æŸ¥æœåŠ¡
```bash
python3 disable_sport_mode.py enp4s0
python3 disable_test_services.py enp4s0
```

---

## âš ï¸ æ•…éšœæ’é™¤

### åŠ¨ä½œæ’­æ”¾å…³èŠ‚æ··ä¹±
**åŸå› ï¼š** å…³èŠ‚é¡ºåºä¸æ­£ç¡®ï¼ˆIsaac é¡ºåº vs MT é¡ºåºï¼‰
**ç°è±¡ï¼š** æœºå™¨äººå§¿æ€æ‰­æ›²ï¼Œå·¦å³å…³èŠ‚å¯¹åº”é”™è¯¯
**è§£å†³ï¼š** 
```bash
# ä½¿ç”¨ --from-isaac æ ‡å¿—é‡æ–°è½¬æ¢
python3 convert_simple_to_deploy.py \
    åŸå§‹æ–‡ä»¶.npz \
    sim2real/assets/data/è¾“å‡ºæ–‡ä»¶.npz \
    --from-isaac

# åœ¨ motion_select ä¸­é‡æ–°åŠ è½½é…ç½®
r
```

### Loop rate: 0 Hz (çœŸæœº)
**åŸå› ï¼š** æœªè¿›å…¥è°ƒè¯•æ¨¡å¼ï¼ˆæ©™ç¯ï¼‰
**è§£å†³ï¼š** æŒ‰ L2 + R2 è¿›å…¥è°ƒè¯•æ¨¡å¼

### å…³èŠ‚æŠ½æ (çœŸæœº)
**åŸå› ï¼š** å†²çªæœåŠ¡æœªå…³é—­
**è§£å†³ï¼š** è¿è¡Œ `disable_test_services.py`

### è¿æ¥å¤±è´¥ (çœŸæœº)
**è§£å†³ï¼š** æ£€æŸ¥ç½‘çº¿å’Œ IP é…ç½®

### ModuleNotFoundError
**ç¼ºå°‘ä¾èµ–ï¼š**
```bash
# å®‰è£…åŸºæœ¬ä¾èµ–
pip install -r sim2real/requirements.txt

# å®‰è£… Unitree SDK
pip install cyclonedds
cd sim2real/unitree_sdk2_python
pip install -e .
```

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æ•°æ®è½¬æ¢
```bash
# Isaac â†’ MT æ ¼å¼è½¬æ¢
python3 convert_simple_to_deploy.py input.npz output.npz --from-isaac

# æ£€æŸ¥æ–‡ä»¶å†…å®¹
python3 -c "import numpy as np; d=np.load('file.npz'); print(list(d.keys()))"
```

### Sim2Sim å¯åŠ¨ï¼ˆä¸‰ç»ˆç«¯ï¼‰
```bash
# Terminal 1: ä»¿çœŸå™¨
python3 sim2real/src/sim2sim.py --xml_path g1/g1.xml

# Terminal 2: æ§åˆ¶å™¨
python3 sim2real/src/deploy.py --net lo --sim2sim

# Terminal 3: åŠ¨ä½œé€‰æ‹©
python3 sim2real/src/motion_select.py
```

### çœŸæœºéƒ¨ç½²
```bash
# 1. é…ç½®ç½‘ç»œ
sudo ip link set enp4s0 up
sudo ip addr add 192.168.123.100/24 dev enp4s0

# 2. æµ‹è¯•è¿æ¥
python3 test_connection.py enp4s0

# 3. å…³é—­å†²çªæœåŠ¡
python3 disable_test_services.py enp4s0

# 4. å¯åŠ¨æ§åˆ¶å™¨
python3 src/deploy.py --net enp4s0 --real

# 5. é¥æ§å™¨ï¼šL2+R2 â†’ start â†’ A
```

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- å®Œæ•´éƒ¨ç½²æŒ‡å—ï¼š`DEPLOYMENT_GUIDE_CN.md`
- æ•°æ®è½¬æ¢è¯¦è§£ï¼š`æ•°æ®è½¬æ¢æŒ‡å—.md`
- Sim2Real READMEï¼š`sim2real/README.md`
